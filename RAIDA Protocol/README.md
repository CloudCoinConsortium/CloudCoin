# RAIDA Protocol

Explains how to send messages to the Redundant Array of Independent Detection Agents and the responses that can be expected.
You will need to send messages to all 25 RAIDA in parallel. 

[RAIDA Requirments](README.md#raida-requirments)

[Notes](README.md#notes)

### Services:

[Echo](README.md#echo)

[Multi-Detect](README.md#multi-detect)

[Hints](README.md#hints)

[Fix](README.md#fix)

[Fix Lost](README.md#fix-lost)

[Report Lost](README.md#report-lost) 

[Recover](README.md#recover) 

-----------------------------------------

## RAIDA Requirments


1. Have Data Supremacy. Cannot be brought down by hackers, governments or even its creators.

2. 100% Privacy. No user accounts, passwords, logins or transactions tracked. 

3. Handle entire worlds traffic. (Simular to the DNS).

4. Transaction Speeds: Less than 2 seconds for 400 notes. 

5. Cannot be permanently lost.

6. Use less than 100 kilowatts of electricty. (Bitcon uses 45 Terawatts).

7. Self funded. No Fees.

8. Cannot be stolen. 

9. Fixed supply - no counterfeits or inflation.

10. Quantum Safe.

11. Be completed by March 2022.

----------------------------------------------

## Notes


### Network Number

All services accept and correctly process the Network Number. Its logical meaning may vary but nn=1 is CloudCoin.
The 'cross-network' operations are considered to be meaningless. That's why all services accept the scalar value nn=X,
regardless GET or POST request is issued.
At the same time for backward compatibility it is allowed:
 - omit either nn= or nns[]= or both. In this case nn= is defaulted to '1'.
 - provide nns[]=. If its length is valid (for example, equal to the length of sns[]) and all values are the same,
 then nn= is taken from nns[0]
 
### Formats of services' responses.
The rule of thumb - if the service is expected to return multiple values (for example Multi-Detect) then it always returns
the JSON array, even if it contains the single message (for example, an error message)
```json
[
    {
        "server": "RAIDA0",
        "status": "dud",
        "message": "Parameters: Input arrays are not the same length.",
        "version": "2019-05-02",
        "time": "2019-05-05 22:32:24"
    }
]
```
Services that always return arrays are:
- multi_detect
- multi_get_ticket
- multi_hints
- multi_fix

In all other cases the single JSON message (dictionary) is returned
```json
{
    "server": "RAIDA0",
    "status": "pass",
    "message": "Authentic: Update your file.",
    "version": "2019-05-02",
    "time": "2019-05-05 22:37:13"
}
```
Sometimes the single JSON message may contain an array inside (for example, 'show')
```json
{
    "server": "RAIDA0",
    "status": "pass",
    "message": [
        {
            "sn": "11",
            "tag": "1Z 999 AA1 01 2345 6784",
            "created": "1557075842"
        },
        {
            "sn": "12",
            "tag": "1Z 999 AA1 01 2345 6784",
            "created": "1557075842"
        }
    ],
    "version": "2019-05-02",
    "time": "2019-05-05 18:22:09",
    "nn": "1",
    "sn": "21"
}
```
It is important to understand that because all output messages are generated by the json-encode library from the internal data representations
the order of fields in any single message **can not** be guaranteed in any way. This means that the client-side developers should not
rely on the order of fields but make use of json decoders and take into account **only** fields names and their values, regardless their mutual order.
This does not apply to the order of array members in the responses. See the detailed explanation in the Multi-Fix section.

### Exit codes, aka 'statuses'

Every response has a 'status' field. Generally, three statuses are common and obligatory:

| Status* | Meaning |
| --- | :--- |
| dud | Some input parameter or combination of parameters is invalid |
| pass | Main operation succeeded |
| fail | Main operation failed |

\* for backward compatibility some services still use the 'historically inherited' statuses. See details in the services' descriptions.

----------------------------------------------

## Echo

### Purpose:
The purpose of the echo API is to allow a program (or user) to establish that a RAIDA is ready to detect the authenticity of CloudCoins and how many milliseconds the contact requires.

The client sends the RAIDA an Echo Request and the RAIDA will respond with a Echo Response.


Echo Request Example:
```
https://RAIDA0.CloudCoin.Global/service/echo
```
Note: Client uses HTTPS and GET method for the echo url located in the service folder on the RAIDA server.


Echo Response Example:
```
{
	"server": "RAIDA11",
	"status": "ready",
	"message": "Execution Time (ms) =0.137",
	"version": "2020-11-02",
	"time": "2020-11-13 01:37:28"
}
```
The execution time is the number of milliseconds that the RAIDA needed to complete a detection request of six loop back coins. This tells us how well the RAIDA is performing internally. 

### Rules:
The RAIDA may not respond if it is unavailable.
All Return Objects' key values are case in-sensitive and should be compared accordingly.
The names of the servers on Network 1 will always be one of 25 servers: RAIDA0 through RAIDA24. Note: server names are case-insensitive and should be compared accordingly.
The status will always be ready otherwise it will return an error. See General Errors.
The subject of the echo response will always be "Up" and the details will always be "Detection agent ready to detect authenticity." otherwise it will return an error. See General Errors.
The time is in GMT.
--------------------------------------
## Multi Detect

The RAIDA Multi Detection Protocol allows many coins to be authenticated at the same time. 
The multi-detect service also returns a "Master Ticket" that can be used to fix any coins that
return fracked. This master-ticket must be used within a few minutes. See the fix service to
know how to use this ticket. 

Example **POST** authenticating three coins
```
https://RAIDA13.CloudCoin.Global/service/multi_ticket
b=t&
nn=1&
sns[]=145895&sns[]=66585&sns[]=16589554&
ans[]=8ae06de0f9ce4917b3309df71570f92c&ans[]=b25fc7a548c341c98cefbac35689aff1&ans[]=f193f1304ffc4344822c10be9309a4c3&
pans[]=c7bea382188d404d8f0efc5969c54c5a&pans[]=75819e4721cb4970a2e2582d7e26318b&pans[]=0a4a8a4014264cbf8c00383ae180a152&
dn[]=1&dn[]=1&dn[]=250
```

Example Response if all tickets were successful:

```json
If all the coins were authentic:
            {
            	"server": "RAIDA11",
            	"status": "allpass",
            	"message": "All the coins were authentic",
		"ticket":"0a4a8a4010a4a8a4014264cbf8c00383ae180a152426",
            	"version": "2020-04-13",
            	"time": "2020-04-18 22:57:55"
            }
        
If all the coins were counterfeit:
            {
             	"server": "RAIDA11",
             	"status": "allfail",
             	"message": "All the coins were counterfeit",
             	"version": "2020-04-13",
             	"time": "2020-04-18 22:57:55"
             }
        
If some of the coins were counterfeit and some were authentic:
             {
             	"server": "RAIDA11",
             	"status": "mixed",
             	"message": "pass,pass,fail",
		"ticket":"0a4a8a4010a4a8a4014264cbf8c00383ae180a152426",
             	"version": "2020-04-13",
             	"time": "2020-04-18 22:57:55"
             }

```
If the status is not allpass, allfail or mixed, it means the call failed. Note that the ticket can be used for fixing fracked coins. 

Response if too many coins attached (over 400)
```json
[
    {
        "server": "RAIDA0",
        "status": "dud",
        "message": "Parameters: Too many coins attached.",
        "version": "2019-05-02",
        "time": "2019-05-06 00:26:46"
    }
]
```
Response if input arrays are not the same length
```json
[
    {
        "server": "RAIDA0",
        "status": "dud",
        "message": "Parameters: Input arrays are not the same length.",
        "version": "2019-05-02",
        "time": "2019-05-06 00:29:11"
    }
]
```

----------------------------------------------


## Hints

Hints is part of the Kerberos system that allow you to see what serial number is associated with a ticket. I allows you to confirm an identity of a person who is making a request.

After running "Detect" you will receieve a "ticket". This ticket can be used to fix any fracked coins. Send this ticket as the "master_ticet" and you will get all the serial numbers of the coins that were detected in the last go. 


Example GET authenticating three coins
```
https://RAIDA0.CloudCoin.Global/service/hints?master_ticket=61fd09083302bb3eb8350dfeb1d7bf6c125b13e560bf

```
The master_ticket is the ticket that the client received from a detect response. 

Example Response if two of the three tickets are failed:
```html
16777214,16277215,16777216
```
The above response shows the results of one master ticket.
These are the serial numbers of the coins that match that master ticket. 


----------------------------------------------

## Fix

Fix allows you to fix many CloudCoins that are fracked at once. You will need to get master tickets from any five of the fracked coin's neighbours.   Suppose you get a coin and pown it. All RAIDA return "allpass" and a each one provides a master ticket. Except for RAIDA 18. RAIDA 18 returns "allfail".  Now you must fix RAIDA 18. You then find out which RAIDA are RAIDA18's trusted neighbours. You will need four. Each RAIDA has four groups of trusted neighbours called "Corners". 


![Image of Trusted Servers](https://cloudcoinconsortium.org/images/fix2.png)

You may start by using RAIDA 18's first corner to fix. That means you require the master tickets returned from multi-detect for RAIDA -6,-5, -1 and + 6 which translates to RAIDA12, RAIDA13, RAIDA17 and RAIDA24. 
You will then send the master tickets from these RAIDA to RAIDA 18. The request calls these servera a, b, c and d. The lowest number RAIDA is 'a' and it accends to the highest number being 'd'. a=12, b=13, c=17 and d=24.(note that lowest to highest does not work if the corner numbers wrap around. The corner that you will use is corner=1. The PAN that you give it will apply to all the coins that you want to fix. If your fix failes on one corner, you can try the other three corners. Note that the fix service can only be run directly after the multi-detect service. If you have a fracked coins that you do not have a master ticket for, you must use the multi-ticket service to get tickets and then use the multi-fix service to fix them. 

Exmple of fixing RAIDA 24. Here the numbers wrap around so they are not lowest to highest. 

| Corner | a  | b  | c  | d  |
|--------|----|----|----|----|
| 1      | 18 | 19 | 23 | 5  |
| 2      | 19 | 20 | 0  | 3  |
| 3      | 3  | 23 | 4  | 20 |
| 4      | 0  | 4  | 5  | 18 |


PARAMETERS:

corner: The four RAIDA that are being used from smalles number to highest number.

pan: All serial numbers will be given the same pan. 

sn[]: Serial Numbers between 1 and 16,777,216 inclusive, to be fixed.

a: The master ticket of the first raida of the corner (going from lowest number to highest number of RAIDA). You get this from the multi-detect request befor.

b: The master ticket of the second raida of the corner 

c: The master ticket of the third raida of the corner 

d: The master ticket of the fourth raida of the corner 


Example Fix using corners. GET authenticating three coins put on several lines for ease of reading
```
https://RAIDA0.CloudCoin.Global/service/fix?
       		corner=1&
		pan=9f70f199f0844df2bd6e607620002cbf&
		a=a4aedc27bf524e3aabf8dbcca686140a8ae06de08934&
		b=11328c19f7ef4a63a4a56d25f9785c05197b44d4bae1&
		c=c35bfa217d364cc58d9c0a96a7a256f4822c10be9233&
		d=48df533f42364308b3a2ce15f1d216e266c649dc656a&
		sn[]=145895&sn[]=66585&sn[]=16589554
```
RESPONSE: If all the coins were authentic
```

            {
            	"server": "RAIDA11",
            	"status": "allpass",
            	"message": "All the coins were authentic",
            	"version": "2020-04-13",
            	"time": "2020-04-18 22:57:55"
            }
        
If all the coins were counterfeit:
            {
             	"server": "RAIDA11",
             	"status": "allfail",
             	"message": "All the coins were counterfeit",
             	"version": "2020-04-13",
             	"time": "2020-04-18 22:57:55"
             }
        
If some of the coins were counterfeit and other authentic:
             {
             	"server": "RAIDA11",
             	"status": "mixed",
             	"message": "pass,pass,fail",
             	"version": "2020-04-13",
             	"time": "2020-04-18 22:57:55"
             }
        
```


Example Fix using 5 touching. 
Note: Use replace the corner with the regex and we add the "e" master ticket. 
```

https://RAIDA0.CloudCoin.Global/service/fix?
       		regex=p.....0...pp.&
		pan=9f70f199f0844df2bd6e607620002cbf&
		a=a4aedc27bf524e3aabf8dbcca686140a8ae06de08934&
		b=11328c19f7ef4a63a4a56d25f9785c05197b44d4bae1&
		c=c35bfa217d364cc58d9c0a96a7a256f4822c10be9233&
		d=48df533f42364308b3a2ce15f1d216e266c649dc656a&
		e=48df533f42364308b3a2ce15f1d216e266c649dc656a&
		sn[]=145895&sn[]=66585&sn[]=16589554
```
RESPONSE: If all the coins were authentic
```

            {
            	"server": "RAIDA11",
            	"status": "allpass",
            	"message": "All the coins were authentic",
            	"version": "2020-04-13",
            	"time": "2020-04-18 22:57:55"
            }
        
If all the coins were counterfeit:
            {
             	"server": "RAIDA11",
             	"status": "allfail",
             	"message": "All the coins were counterfeit",
             	"version": "2020-04-13",
             	"time": "2020-04-18 22:57:55"
             }
        
If some of the coins were counterfeit and other authentic:
             {
             	"server": "RAIDA11",
             	"status": "mixed",
             	"message": "pass,pass,fail",
             	"version": "2020-04-13",
             	"time": "2020-04-18 22:57:55"
             }
        
```
Possible Regex values
```
Corners
1. p.....0...pp.
2. ..p..p0...pp.
3. .pp...0p..p..
4. p.....0p...pp

Boomerrang
1. p....p0...pppp
2. ppp..p0...p..
3. ppp..p0p....p
4. ..p...0p..ppp

Bowl
1. pp...p0...pp.
2. ppp..p0p.....
3. .pp...0p...pp
4. .....p0p..ppp

Spaceship
1. pp....0p..pp.
2. p.p..p0p...p.
3. .pp..p0....pp
4. .p...p0p..p.p

Creeper
1. ppp...0...p.p
2. p.p...0p..p.p
3. p.p...0...ppp
4. p.p..p0...p.p

Jay
1. ppp...0...pp.
2. p.p..p0p....p
3. .pp...0...ppp
4. p....p0p..p.p

One
ppp...0....pp
..p..p0p..p.p
pp....0...ppp
p.p..p0p..p..
```
Regex used in programming:
```
Corners
1. p.....[uenf]...pp.
2. ..p..p[uenf]...pp.
3. .pp...[uenf]p..p..
4. p.....[uenf]p...pp

Boomerrang
1. p....p[uenf]...pppp
2. ppp..p[uenf]...p..
3. ppp..p[uenf]p....p
4. ..p...[uenf]p..ppp

Bowl
1. pp...p[uenf]...pp.
2. ppp..p[uenf]p.....
3. .pp...[uenf]p...pp
4. .....p[uenf]p..ppp

Spaceship
1. pp....[uenf]p..pp.
2. p.p..p[uenf]p...p.
3. .pp..p[uenf]....pp
4. .p...p[uenf]p..p.p

Creeper
1. ppp...[uenf]...p.p
2. p.p...[uenf]p..p.p
3. p.p...[uenf]...ppp
4. p.p..p[uenf]...p.p

Jay
1. ppp...[uenf]...pp.
2. p.p..p[uenf]p....p
3. .pp...[uenf]...ppp
4. p....p[uenf]p..p.p

One
ppp...[uenf]....pp
..p..p[uenf]p..p.p
pp....[uenf]...ppp
p.p..p[uenf]p..p..
```

----------------------------------------------

## Fix Lost

The RAIDA Fix Lost Protocol allows many coins that are considered lost to be found.
A lost coin is created when a coin is detected but there is no response from the RAIDA. 
This means that it is uncertain if the AN or PAN is the Authenticity Number on the RAIDA.

The Fix Lost service allows the caller to send both AN and PAN to see if they are authentic.
The service then responds with the correct answer. If neither are correct, it will respond with 
a status of "Neither"

Example **POST** authenticating three coins
```
https://RAIDA0.CloudCoin.Global/service/fix_lost
  nn=1& \
  sns[]=1& \
  sns[]=3& \
  sns[]=7& \
  ans[]=9656ab1c988bc5347e5a5d331e3da401& \
  ans[]=1808b37cd2d72a0e2dd2675e3fb42b02& \
  ans[]=83492f468a0e4a21cb8b2aa2a94d640& \
  pans[]=9656ab1c988bc5347e5a5d331e3da401& \
  pans[]=1808b37cd2d72a0e2dd2675e3fb42b03& \
  pans[]=83492f468a0e4a21cb8b2aa2a94d6407& \
  denomination[]=1& \
  denomination[]=1& \
  denomination[]=1
```
Example response (the second coin failed, the third one has an error in AN):
```json
[
    {
        "server": "RAIDA0",
        "status": "an",
        "message": "9656ab1c988bc5347e5a5d331e3da401",
        "version": "2019-05-02",
        "time": "2019-05-06 00:19:27"
    },
    {
        "server": "RAIDA0",
        "status": "pan",
        "message": "1808b37cd2d72a0e2dd2675e3fb42b03",
        "version": "2019-05-02",
        "time": "2019-05-06 00:19:27",
        "nn": "1",
        "sn": "3"
    },
    {
        "server": "RAIDA0",
        "status": "neither",
        "message": "",
        "version": "2019-05-02",
        "time": "2019-05-06 00:30:16"
    }
]
```
Response if too many coins attached (over 4000)
```json
[
    {
        "server": "RAIDA0",
        "status": "dud",
        "message": "Parameters: Too many coins attached.",
        "version": "2019-05-02",
        "time": "2019-05-06 00:26:46"
    }
]
```
Response if input arrays are not the same length
```json
[
    {
        "server": "RAIDA0",
        "status": "dud",
        "message": "Parameters: Input arrays are not the same length.",
        "version": "2019-05-02",
        "time": "2019-05-06 00:29:11"
    }
]
```

## Recover
