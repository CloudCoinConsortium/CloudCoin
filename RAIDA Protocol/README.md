# RAIDA Protocol

Explains how to send messages to the Redundant Array of Independent Detection Agents and the responses that can be expected.
You will need to send messages to all 25 RAIDA in parallel. 
### Notes: 

[RAIDA Requirments](README.md#raida-requirments)

[Notes](README.md#notes)

### Services:

[Echo](README.md#echo-service)

[Echo DA](README.md#echo-da-service)

[Multi-Detect](README.md#raida-multi-detect-service)

[Multi-Ticket](README.md#raida-multi-ticket-protocol)

[Multi-Hints](README.md#raida-multi-hints-protocol)

[Multi Fix](README.md#raida-multi-fix-protocol)

[Fix Lost](README.md#raida-fix_lost-service)

[Report Lost](README.md#report-lost) 

-----------------------------------------

## RAIDA Requirments


1. Have Data Supremacy. Cannot be brought down by hackers, governments or even its creators.

2. 100% Privacy. No user accounts, passwords, logins or transactions tracked. 

3. Handle entire worlds traffic. (Simular to the DNS).

4. Transaction Speeds: Less than 2 seconds for 400 notes. 

5. Cannot be permanently lost.

6. Use less than 100 kilowatts of electricty. (Bitcon uses 45 Terawatts).

7. Self funded. No Fees.

8. Cannot be stolen. 

9. Fixed supply - no counterfeits or inflation.

10. Quantum Safe.

11. Be completed by March 2022.

----------------------------------------------

## Notes


### Network Number

All services accept and correctly process the Network Number. Its logical meaning may vary but nn=1 is CloudCoin.
The 'cross-network' operations are considered to be meaningless. That's why all services accept the scalar value nn=X,
regardless GET or POST request is issued.
At the same time for backward compatibility it is allowed:
 - omit either nn= or nns[]= or both. In this case nn= is defaulted to '1'.
 - provide nns[]=. If its length is valid (for example, equal to the length of sns[]) and all values are the same,
 then nn= is taken from nns[0]
 
### Formats of services' responses.
The rule of thumb - if the service is expected to return multiple values (for example Multi-Detect) then it always returns
the JSON array, even if it contains the single message (for example, an error message)
```json
[
    {
        "server": "RAIDA0",
        "status": "dud",
        "message": "Parameters: Input arrays are not the same length.",
        "version": "2019-05-02",
        "time": "2019-05-05 22:32:24"
    }
]
```
Services that always return arrays are:
- multi_detect
- multi_get_ticket
- multi_hints
- multi_fix

In all other cases the single JSON message (dictionary) is returned
```json
{
    "server": "RAIDA0",
    "status": "pass",
    "message": "Authentic: Update your file.",
    "version": "2019-05-02",
    "time": "2019-05-05 22:37:13"
}
```
Sometimes the single JSON message may contain an array inside (for example, 'show')
```json
{
    "server": "RAIDA0",
    "status": "pass",
    "message": [
        {
            "sn": "11",
            "tag": "1Z 999 AA1 01 2345 6784",
            "created": "1557075842"
        },
        {
            "sn": "12",
            "tag": "1Z 999 AA1 01 2345 6784",
            "created": "1557075842"
        }
    ],
    "version": "2019-05-02",
    "time": "2019-05-05 18:22:09",
    "nn": "1",
    "sn": "21"
}
```
It is important to understand that because all output messages are generated by the json-encode library from the internal data representations
the order of fields in any single message **can not** be guaranteed in any way. This means that the client-side developers should not
rely on the order of fields but make use of json decoders and take into account **only** fields names and their values, regardless their mutual order.
This does not apply to the order of array members in the responses. See the detailed explanation in the Multi-Fix section.

### Exit codes, aka 'statuses'

Every response has a 'status' field. Generally, three statuses are common and obligatory:

| Status* | Meaning |
| --- | :--- |
| dud | Some input parameter or combination of parameters is invalid |
| pass | Main operation succeeded |
| fail | Main operation failed |

\* for backward compatibility some services still use the 'historically inherited' statuses. See details in the services' descriptions.

----------------------------------------------

## Echo Service

### Purpose:
The purpose of the echo API is to allow a program (or user) to establish that a RAIDA is ready to detect the authenticity of CloudCoins and how many milliseconds the contact requires.

The client sends the RAIDA an Echo Request and the RAIDA will respond with a Echo Response.


Echo Request Example:
```
https://RAIDA0.CloudCoin.Global/service/echo
```
Note: Client uses HTTPS and GET method for the echo url located in the service folder on the RAIDA server.


Echo Response Example:
```
{
 "server":"RAIDA0",
 "status":"ready",
 "message":"Execution Time (milliseconds) = 2.3751258850098",
 "time":"2018-03-28 02:14:43"
}
```
The execution time is the number of milliseconds that the RAIDA needed to complete a detection request of six loop back coins. This tells us how well the RAIDA is performing internally. 

### Rules:
The RAIDA may not respond if it is unavailable.
All Return Objects' key values are case in-sensitive and should be compared accordingly.
The names of the servers on Network 1 will always be one of 25 servers: RAIDA0 through RAIDA24. Note: server names are case-insensitive and should be compared accordingly.
The status will always be ready otherwise it will return an error. See General Errors.
The subject of the echo response will always be "Up" and the details will always be "Detection agent ready to detect authenticity." otherwise it will return an error. See General Errors.
The time is in GMT.

----------------------------------------------

## Echo DA Service

----------------------------------------------

Sample *GET* request:
```http
https://RAIDA11.CloudCoin.Global/service/echo_da?da=3&utr=false. 
```

The "da" is a number between 1 and 32 (Or perhaps 0 and 31) that represents the Detection Agent Number.
The "utr" means uptime robot. If it is set to true, then the service will not respond if the Detection Agent is off line. This will allow uptime robot to tell if the service is up or not. 

Responses:
Server returns a Response Object using JSON that describes the name of the server, the status, a message, and a timestamp:

 
Sample Response if the DA is up and working:
```json
{
 "server":"RAIDA11",
 "da":"3",
 "status":"ready",
 "message":"Execution Time (milliseconds) = 2.3751258850098",
 "time":"2018-03-28 02:14:43"
}
```
Sample Response if the DA is down and does not respond and utr is set to "false":
```json
{
 "server":"RAIDA11",
 "da":"3",
 "status":"offline",
 "message":"Execution Time (milliseconds) = 2.3751258850098",
 "time":"2018-03-28 02:14:43"
}
```
Sample Response if the DA is down and does not respond and utr is set to "true":
```php
/* There will be no response if utr=true */
```

Sample Response if the RAIDA does not use Sentinel/DAs:
```json
{
 "server":"RAIDA11",
 "da":"3",
 "status":"ready",
 "message":"Execution Time (milliseconds) = 2.3751258850098",
 "time":"2018-03-28 02:14:43"
}
```


----------------------------------------------

## RAIDA 'Detect' Service

Detect service authenticates single CloudCoin. In case of success the AN is replaced with PAN which in turn should be replaced in the local CloudCoin file (stack).

Example **GET**
```
Usage: https://raida0.cloudcoin.global/service/detect?nn=1&sn=5&an=9902d9609c58bbe237fff9769504b805&pan=9902d9609c58bbe237fff9769504b805&denomination=1
```
Response if success
```json
{
    "server": "RAIDA0",
    "status": "pass",
    "message": "Authentic: Update your file.",
    "version": "2019-05-02",
    "time": "2019-05-05 22:37:13"
}
```
Response if some parameters are incorrect
```json
{
    "server": "RAIDA0",
    "status": "dud",
    "message": "Parameters: Some or all input parameters are not valid.",
    "version": "2019-05-02",
    "time": "2019-05-06 00:07:56"
}
```
Response if the coin is not authenticated
```json
{
    "server": "RAIDA0",
    "status": "fail",
    "message": "Counterfeit: The unit failed to authenticate on this server.",
    "version": "2019-05-02",
    "time": "2019-05-06 00:09:31",
    "nn": "1",
    "sn": "5"
}
```
For historical reasons the 'detect' service supports the b= parameter (which can be either 't' or 'true').
This denotes the so-called 'brief' mode. It means that the response is a single word 'pass' or 'fail'.


----------------------------------------------

## RAIDA 'Multi-Detect' Service

The RAIDA Multi Detection Protocol allows many coins to be authenticated at the same time.

Example **POST** authenticating three coins
```
https://RAIDA0.CloudCoin.Global/service/multi_detect
  nn=1& \
  sns[]=1& \
  sns[]=3& \
  sns[]=7& \
  ans[]=9656ab1c988bc5347e5a5d331e3da401& \
  ans[]=1808b37cd2d72a0e2dd2675e3fb42b02& \
  ans[]=83492f468a0e4a21cb8b2aa2a94d640& \
  pans[]=9656ab1c988bc5347e5a5d331e3da401& \
  pans[]=1808b37cd2d72a0e2dd2675e3fb42b03& \
  pans[]=83492f468a0e4a21cb8b2aa2a94d6407& \
  denomination[]=1& \
  denomination[]=1& \
  denomination[]=1
```
Example response (the second coin failed, the third one has an error in AN):
```json
[
    {
        "server": "RAIDA0",
        "status": "pass",
        "message": "Authentic: Update your file.",
        "version": "2019-05-02",
        "time": "2019-05-06 00:19:27"
    },
    {
        "server": "RAIDA0",
        "status": "fail",
        "message": "Counterfeit: The unit failed to authenticate on this server.",
        "version": "2019-05-02",
        "time": "2019-05-06 00:19:27",
        "nn": "1",
        "sn": "3"
    },
    {
        "server": "RAIDA0",
        "status": "dud",
        "message": "Parameters: Some or all input parameters are not valid.",
        "version": "2019-05-02",
        "time": "2019-05-06 00:30:16"
    }
]
```
Response if too many coins attached (over 400)
```json
[
    {
        "server": "RAIDA0",
        "status": "dud",
        "message": "Parameters: Too many coins attached.",
        "version": "2019-05-02",
        "time": "2019-05-06 00:26:46"
    }
]
```
Response if input arrays are not the same length
```json
[
    {
        "server": "RAIDA0",
        "status": "dud",
        "message": "Parameters: Input arrays are not the same length.",
        "version": "2019-05-02",
        "time": "2019-05-06 00:29:11"
    }
]
```

----------------------------------------------

## RAIDA Multi-Ticket Protocol

The RAIDA Multi Ticket Protocol allows many tickets to be generated at the same time.

Example POST requesting three tickets
```
Usage: https://RAIDA13.CloudCoin.Global/service/multi_ticket
nns[]=1&nns[]=1&nns[]=1&
sns[]=145895&sns[]=66585&sns[]=16589554&
ans[]=8ae06de0f9ce4917b3309df71570f92c&ans[]=b25fc7a548c341c98cefbac35689aff1&ans[]=f193f1304ffc4344822c10be9309a4c3&
pans[]=c7bea382188d404d8f0efc5969c54c5a&pans[]=75819e4721cb4970a2e2582d7e26318b&pans[]=0a4a8a4014264cbf8c00383ae180a152&
denomination[]=1&denomination[]=1&denomination[]=1
```

Example Response if all tickets were successful:

```json
[
  {
  "server": "RAIDA13",
		"status": "ticket",
		"sn": "145895",
		"version": "2018-04-01",
		"message": "10be9309a4c3f193f1304ffc4344822c10be9309a4c3",
		"time": "2018-09-05 06:19:34"
	},
	{
		"server": "RAIDA13",
		"status": "ticket",
		"sn": "66585",
		"version": "2018-04-01",
		"message": "304ffc434482210be9309a4c3f193f1c10be9309a4c3",
		"time": "2018-09-05 06:19:34"
	},
	{
		"server": "RAIDA13",
		"status": "ticket",
		"sn": "16589554",
		"version": "2018-04-01",
		"message": "4c3f193f1304f10be9309afc4344822c10be9309a4c3",
		"time": "2018-09-05 06:19:34"
	}
]

```

Example Response if all tickets failed:

```html

[{
		"server": "RAIDA13",
		"status": "fail",
		"version": "2018-04-01",
		"message" : "Database: Operation failed. Ticket has not been created.",
		"time": "2018-09-05 06:19:34"
	},
	{
		"server": "RAIDA13",
		"status": "fail",
		"version": "2018-04-01",
		"message" : "Database: Operation failed. Ticket has not been created.",
		"time": "2018-09-05 06:19:34"
	},
	{
		"server": "RAIDA13",
		"status": "fail",
		"version": "2018-04-01",
		"message" : "Database: Operation failed. Ticket has not been created.",
		"time": "2018-09-05 06:19:34"
	}
]

```

The last byte of each ticket (returned in the 'message' field) in the response holds the Detection Agent number. This number can be used by RAIDA server to forward the request to the corresponding Detection Agent.


----------------------------------------------

## RAIDA Multi-Hints Protocol

Hints is part of the Kerberos system that allow you to see what serial number is associated with a ticket. I allows you to confirm an identity of a person who is making a request.

Someone gives you a ticket claiming to be SN 2092. You send the ticket to the RAIDA. The RAIDA will response with either

1. The serial number that you can use to check the cliam. e.g. 2092 

2. A ticket not found code: -2

3. A database error code: -3


Example POST authenticating three coins
```
https://RAIDA0.CloudCoin.Global/service/multi_hints
rns[]=c8b7a96e7cf1961587977cfb3847b2ba7c7a308a3fd2&rns[]=61fd09083302bb3eb8350dfeb1d7bf6c125b13e560bf&rns[]=dcea173685e387f7007bf2e578917cbdd10750088c29
```
The rns are the tickets that the client received from a multi-ticket response. 

Example Response if two of the three tickets are failed:
```html
[ -2:9223372036854775807:1, 16777215:232:1, 2092:6447:1]
```
The above response shows the results of three tickets.
The first one shows that the ticket was not found and the time it took was max and the network was 1.
The second response shows that the ticket belongs to SN 16777215 and it was made 232 milliseconds ago. It was on network 1. 



----------------------------------------------

## RAIDA Multi Fix Protocol

The RAIDA Multi Fix Protocol allows many coins with the same fracked RAIDA# to be fixed using the same "Corner" at the same. All the coins must be on the same network.

This protocol only works with the "Four-Fix" protocol in which three trusted raida on one corner and one trusted raida on the oposite corner are required to fix. 

The client would first scan the fracked folder and find all the CloudCoins that are fracked on RAIDA0.

Then the client would collect multi-tickets from RAIDA0's four trusted servers (using the  fix 4 - not fix 3 - protocol) for corner one. The essential requirement here is that client must generate multi_ticket requests using the same order of SNs across all four servers.

After the fix attempt, the CloudCoin files would be updated. Then RAIDA would be checked again. If there are still fracked coins then the client would try again this time using corner #2. Only after all the Coins are fixed on RAIDA0 or all the corners have been tried, the client move on to RAIDA1. This process would repeat until all 25 RAIDA have been tried. 

Then the process would be reversed as some of the recently fixed RAIDA may be able to aid in fixing others.  


Example POST authenticating three coins
```
https://RAIDA0.CloudCoin.Global/service/multi_fix

nn[]=1

fromserver1[]=19 
fromserver2[]=20
fromserver3[]=24
fromserver4[]=6

message1[]=cdd8a04b46b2484aa2b02d3d2279216009cf35f63632
message1[]=4aa2b02d3d2279216009cfcdd8a0835f636324b46b24 
message1[]=2b02d34aad2279216004b46b24835f6363209cfcdd8a

message2[]=4aa216009cfcdd8a04b46b24835f636322b02d3d2279
message2[]=3d227924aa2b02d16009cfcdd8a04b46b24835f63632
message2[]=4aa2b02d16009cfcdd8ad2279224835f6363204b46b3

message3[]=5f63634aa2b02d3d2279216009cfcdd8a04b46b24835
message3[]=2b02d34aad6009cfcdd8a04b46b24835f63632227921
message3[]=4aa2b02d3d2279216009cfcdd8a04b46b24835f63632

message4[]=d2272b02d3009cfcdd8a04b46b24835f6363292164aa
message4[]=a04b46b2d3d22fcdd824835f6363279216009c4aa2b0
message4[]=fcdd8a04b46b24835f636324aa2b02d3d2279216009c

pans[]=8ae06de0f9ce4917b3309df71570f92c
pans[]=b25fc7a548c341c98cefbac35689aff1
pans[]=f193f1304ffc4344822c10be9309a4c3
```

RESPONSE:
```
[{
  "server":"RAIDA19",
  "status":"success",
  "sn":"145895",
  "nn":"1",
  "message":"Fixed: Unit's AN was changed to the PAN. Update your AN to the new PAN.",
  "time":"2016-44-19 7:44:PM"
},
{
  "server":"RAIDA19",
  "status":"success",
  "sn":"66585",
  "nn":"1",
  "message":"Fixed: Unit's AN was changed to the PAN. Update your AN to the new PAN.",
  "time":"2016-44-19 7:44:PM"
},
{
  "server":"RAIDA19",
  "status":"error",
  "sn":"16589554",
  "nn":"1",
  "message":"Connection: Could not connect to Server 11.",
  "time":"2016-44-19 7:44:PM"
}]
```

RESPONSE IF TOO MANY COINS SENT (OVER 400)
```
{
  "server":"RAIDA19",
  "status":"dud",
  "message":"Length: Too many coins attached.",
  "time":"2016-44-19 7:44:PM"
}
```

RESPONSE IF ARRAY LENGTHS NOT THE SAME
```
{
  "server":"RAIDA19",
  "status":"dud",
  "message":"Length: Arrays not all the same length (nn,sn,an,denominations).",
  "time":"2016-44-19 7:44:PM"
}
```


----------------------------------------------

## RAIDA 'fix_lost' Service

The RAIDA Fix Lost Protocol allows many coins that are considered lost to be found.
A lost coin is created when a coin is detected but there is no response from the RAIDA. 
This means that it is uncertain if the AN or PAN is the Authenticity Number on the RAIDA.

The Fix Lost service allows the caller to send both AN and PAN to see if they are authentic.
The service then responds with the correct answer. If neither are correct, it will respond with 
a status of "Neither"

Example **POST** authenticating three coins
```
https://RAIDA0.CloudCoin.Global/service/fix_lost
  nn=1& \
  sns[]=1& \
  sns[]=3& \
  sns[]=7& \
  ans[]=9656ab1c988bc5347e5a5d331e3da401& \
  ans[]=1808b37cd2d72a0e2dd2675e3fb42b02& \
  ans[]=83492f468a0e4a21cb8b2aa2a94d640& \
  pans[]=9656ab1c988bc5347e5a5d331e3da401& \
  pans[]=1808b37cd2d72a0e2dd2675e3fb42b03& \
  pans[]=83492f468a0e4a21cb8b2aa2a94d6407& \
  denomination[]=1& \
  denomination[]=1& \
  denomination[]=1
```
Example response (the second coin failed, the third one has an error in AN):
```json
[
    {
        "server": "RAIDA0",
        "status": "an",
        "message": "9656ab1c988bc5347e5a5d331e3da401",
        "version": "2019-05-02",
        "time": "2019-05-06 00:19:27"
    },
    {
        "server": "RAIDA0",
        "status": "pan",
        "message": "1808b37cd2d72a0e2dd2675e3fb42b03",
        "version": "2019-05-02",
        "time": "2019-05-06 00:19:27",
        "nn": "1",
        "sn": "3"
    },
    {
        "server": "RAIDA0",
        "status": "neither",
        "message": "",
        "version": "2019-05-02",
        "time": "2019-05-06 00:30:16"
    }
]
```
Response if too many coins attached (over 4000)
```json
[
    {
        "server": "RAIDA0",
        "status": "dud",
        "message": "Parameters: Too many coins attached.",
        "version": "2019-05-02",
        "time": "2019-05-06 00:26:46"
    }
]
```
Response if input arrays are not the same length
```json
[
    {
        "server": "RAIDA0",
        "status": "dud",
        "message": "Parameters: Input arrays are not the same length.",
        "version": "2019-05-02",
        "time": "2019-05-06 00:29:11"
    }
]
```

